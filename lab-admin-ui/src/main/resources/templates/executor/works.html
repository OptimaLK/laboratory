<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
>

<link rel="stylesheet" th:href="@{/css/works.css}">
<head th:replace="fragments/executor/header :: head"></head>

<body class="bg-light">

<div th:replace="fragments/executor/header :: header"></div>

<div>
    <form>
        <button class="button_arc" type="submit">Архив</button>
    </form>
</div>
<div class="d-flex justify-content-center">
    <div class="work_attrs">
        <dl class="dl-horizontal work_head" th:each="wor : ${work}">
            <div>
                <dt>№ заявки:</dt>
                <dd th:text="${wor.id}"></dd>
                <dt>Дата регистрации:</dt>
                <dd th:text="${wor.registrationDate}"></dd>
                <dt>Заказчик:</dt>
                <dd th:text="${wor.customer}"></dd>
                <dt>Объект:</dt>
                <dd th:text="${wor.objectName}"></dd>
                <dt>Срок:</dt>
                <dd>04.05.2021</dd>
                <dt>Договор:</dt>
                <dd th:text="${wor.numberContract}"></dd>
                <dt>Доп. информация:</dt>
                <dd>т. 8-999-999-99-99</dd>
                <dt>Команда:</dt>
                <dd class="d-flex justify-content-between add_user" style="width: 185px;">
                    <div>
                        <ul th:id="team">
                            <li th:each="user : ${wor.users}" th:text="${user.lastName}"></li>
                        </ul>
                    </div>
                    <div th:id="addU">
                        <a class="nav-link dropdown-toggle" data-toggle="dropdown">
                            <i aria-hidden="true" class="fa fa-user-plus"></i>
                        </a>
                        <div>
                            <ul aria-labelledby="logged-in-username"
                                class="dropdown-menu dropdown-menu-right drop_menu">
                                <li th:id="menu"><a class="dropdown-item" style="display:block;"
                                                     th:each="usr : ${users}"
                                                     th:href="@{/work/user/{workId}/{userId}(userId=${usr.id}, workId=${wor.id})}"
                                                     th:text="${usr.getLastName()}"></a></li>
                            </ul>
                        </div>
                    </div>
                </dd>
            </div>
            <div th:switch="${wor.getActual}">
                <form method="POST" th:action="@{/work/{id}/done(id=${wor.id})}" th:case="${true}">
                    <button type="submit"> Закрыть</button>
                </form>
                <button style="background-color: #ffbebe" th:case="${false}" type="submit">Выполнено</button>
            </div>
        </dl>
    </div>
</div>

<script th:replace="fragments/executor/footer :: scripts"></script>
<script>
    $(function () {
        $('.add_user').each(function () {
            var master = this;
            $('#addU a', master).on('click', function () {
                console.log('exec');
                $('#team li', master).each(function () {
                    var te = this;
                    $('#menu a', master).each(function () {
                        if ($(this).text() === $(te).text()) {
                            console.log('true', $(this).text(), $(te).text());
                            $(this).hide();
                        }
                    })
                })
            });
        });
    });
</script>

</body>
</html>